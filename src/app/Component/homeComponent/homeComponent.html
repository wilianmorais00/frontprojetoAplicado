<div class="home-page">
  <header class="topbar">
    <div class="user-chip">
      <span class="avatar" aria-hidden="true">üë§</span>
      <span class="welcome">BEM-VINDO</span>
    </div>

    <nav class="actions">
      <button class="icon-btn" (click)="goHome()" aria-label="In√≠cio" title="In√≠cio">
        <span class="i i-home"></span>
      </button>
      <button class="icon-btn" (click)="openSettings()" aria-label="Configura√ß√µes" title="Configura√ß√µes">
        <span class="i i-gear"></span>
      </button>
    </nav>
  </header>

  <section class="section">
    <h2 class="section-title">NOVOS DADOS</h2>

    <div class="templates-layout">
      <div class="shelf">
        <button class="tile tile-primary" (click)="onClickNewForm()">
          <span class="tile-plus">+</span>
          <span class="tile-title">NOVO FORMUL√ÅRIO</span>
        </button>
      </div>

      <button class="tile tile-primary side-action" (click)="onClickNewClient()">
        <span class="tile-plus">+</span>
        <span class="tile-title">NOVO H√ìSPEDE</span>
      </button>
    </div>
  </section>

  <section class="section">
    <h2 class="section-title">LOCALIZAR H√ìSPEDE</h2>

    <div class="manage-area">
      <div class="search-card">
        <div class="search-label">Procure por nome completo do h√≥spede ou n√∫mero do quarto</div>

        <div class="search-row">
          <input
            class="search-input"
            type="text"
            [formControl]="searchCtrl"
            placeholder="Ex.: Ana Silva ou 203"
            aria-label="Buscar cliente ou quarto" />
          <button class="btn ghost small" type="button" (click)="searchCtrl.setValue('')">Limpar</button>
        </div>

        <ul class="results-list" *ngIf="hasQuery && filteredClients.length">
          <li class="result-item" *ngFor="let c of filteredClients">
            <div class="result-title">
              <span class="result-avatar">üë§</span>
              <span class="result-name">{{ c.name }}</span>
              <span class="result-chip">Quarto {{ c.room }}</span>
            </div>
            <div class="result-meta">{{ c.email }} ‚Ä¢ {{ c.phone }}</div>

            <div class="result-actions">
              <button class="pill neutral" type="button" (click)="startAssign(c)">ATRIBUIR</button>
              <button title="Editar" class="icon-mini edit" type="button" (click)="selectClient(c)">‚úé</button>
              <button title="Remover" class="icon-mini danger" type="button" (click)="clientsSvc.remove(c.id)">üóëÔ∏è</button>
            </div>
          </li>
        </ul>

        <div class="no-results" *ngIf="hasQuery && !filteredClients.length">
          Nenhum cliente encontrado.
        </div>
      </div>

      <div class="edit-card" *ngIf="selected">
        <h3 class="edit-title">Editar dados do cliente</h3>

        <form [formGroup]="editForm" class="edit-form" (ngSubmit)="saveEdits()">
          <label class="field">
            <span class="field-label">Nome</span>
            <input class="field-input" type="text" formControlName="name" placeholder="Nome completo" />
          </label>

          <label class="field">
            <span class="field-label">Quarto</span>
            <input class="field-input" type="text" formControlName="room" placeholder="Ex.: 305" />
          </label>

          <label class="field">
            <span class="field-label">E-mail</span>
            <input class="field-input" type="email" formControlName="email" placeholder="email@exemplo.com" />
          </label>

          <label class="field">
            <span class="field-label">Telefone</span>
            <input class="field-input" type="text" formControlName="phone" placeholder="(11) 90000-0000" />
          </label>

          <div class="edit-actions">
            <button type="button" class="btn ghost" (click)="cancelEdit()">Cancelar</button>
            <button type="submit" class="btn primary">Salvar</button>
          </div>
        </form>
      </div>
    </div>
  </section>

  <section class="section">
    <h2 class="section-title">FORMUL√ÅRIOS EM ABERTO</h2>

    <div *ngIf="banner" class="toast success">{{ banner }}</div>

    <ng-container *ngIf="hasOpenForms; else emptyState">
      <div class="open-grid">
        <article class="open-card" *ngFor="let c of openFormCards">
          <header class="open-head">
            <h3 class="open-title">{{ c.title }}</h3>
          </header>

          <div class="open-actions">
            <button type="button" class="pill success" (click)="accessForm(c)">ACESSAR</button>
            <button type="button" class="trash-btn" (click)="deleteForm(c)" aria-label="Excluir">üóëÔ∏è</button>
          </div>
        </article>
      </div>
    </ng-container>

    <ng-template #emptyState>
      <div class="empty-state">Nenhum formul√°rio criado ou respondido</div>
    </ng-template>
  </section>

  <!-- Modal de sele√ß√£o de formul√°rio -->
  <div class="modal-backdrop" *ngIf="assigningClient" (click)="closeAssign()"></div>
  <div class="modal" *ngIf="assigningClient">
    <div class="modal-head">
      <h3 class="modal-title">Atribuir formul√°rio para {{ assigningClient?.name }}</h3>
      <button class="icon-mini danger" type="button" (click)="closeAssign()">‚úñ</button>
    </div>

    <div class="modal-body" *ngIf="openFormCards.length; else noForms">
      <ul class="modal-list">
        <li class="modal-item" *ngFor="let f of openFormCards" (click)="selectedTemplateId = f.id"
            [class.active]="selectedTemplateId === f.id">
          <div class="mi-title">{{ f.title }}</div>
          <div class="mi-meta">Criado em {{ formatDate(f.createdAt) }}</div>
          <input type="radio" name="tpl" [checked]="selectedTemplateId === f.id" />
        </li>
      </ul>
      <div class="modal-actions">
        <button class="btn ghost" type="button" (click)="closeAssign()">Cancelar</button>
        <button class="btn primary" type="button" [disabled]="!selectedTemplateId" (click)="confirmAssign()">Atribuir</button>
      </div>
    </div>

    <ng-template #noForms>
      <div class="no-forms">Nenhum formul√°rio dispon√≠vel.</div>
      <div class="modal-actions">
        <button class="btn ghost" type="button" (click)="closeAssign()">Fechar</button>
      </div>
    </ng-template>
  </div>
</div>
